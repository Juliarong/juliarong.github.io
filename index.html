<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¿«ä¹è¯»ä¹¦å§ - é˜…è¯»é—¯å…³å¤§å†’é™©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Segoe UI Emoji', 'å¾®è½¯é›…é»‘', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6ecbf5 0%, #059ee3 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            background: linear-gradient(to right, #ff6b6b, #ffcc00, #4d9feb);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2rem;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }

        /* å››å®«æ ¼å¸ƒå±€ */
        .game-map-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 30px auto;
            max-width: 500px;
        }

        .map-level {
            text-align: center;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .map-level:hover {
            transform: translateY(-5px);
        }

        .map-level-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin: 0 auto 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }

        .map-level-1 .map-level-icon { background: linear-gradient(135deg, #4caf50, #8bc34a); }
        .map-level-2 .map-level-icon { background: linear-gradient(135deg, #ff9800, #ffb74d); }
        .map-level-3 .map-level-icon { background: linear-gradient(135deg, #f44336, #ef5350); }
        .map-level-4 .map-level-icon { background: linear-gradient(135deg, #9c27b0, #ba68c8); }

        .map-level-icon.locked {
            background: linear-gradient(135deg, #9e9e9e, #bdbdbd) !important;
            opacity: 0.7;
        }

        .map-level-name {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .map-level-desc {
            color: #666;
            font-size: 0.8rem;
            line-height: 1.3;
        }

        /* æŒ‰é’®æ ·å¼ */
        .start-button {
            background: linear-gradient(to right, #ff6b6b, #ffcc00);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 5px;
            width: 220px;
            justify-content: center;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 107, 107, 0.4);
        }

        .start-button.locked {
            background: linear-gradient(to right, #9e9e9e, #bdbdbd);
            cursor: not-allowed;
        }

        /* æ¸¸æˆåŒºåŸŸç®€åŒ– */
        .game-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }

        /* é™æ—¶å™¨ - 10ç§’ */
        .timer-container {
            background: #ff6b6b;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px auto;
            width: fit-content;
        }

        .timer-container.warning {
            background: #ff9800;
            animation: pulse 1s infinite;
        }

        .timer-container.danger {
            background: #f44336;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* é¢˜ç›®åŒºåŸŸ */
        .question-container {
            margin: 20px 0;
        }

        .question-text {
            font-size: 1.2rem;
            line-height: 1.5;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #4d9feb;
            margin-bottom: 20px;
        }

        /* é€‰é¡¹åŒºåŸŸ */
        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .option {
            background: #f1f8ff;
            border: 2px solid #c1e1ff;
            border-radius: 10px;
            padding: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option:hover {
            background: #e1f0ff;
            transform: translateY(-2px);
        }

        .option.selected {
            background: #ffeb3b;
            border-color: #ffcc00;
        }

        .option.correct {
            background: #c8e6c9;
            border-color: #4caf50;
        }

        .option.incorrect {
            background: #ffccbc;
            border-color: #ff6b6b;
        }

        .option.disabled {
            pointer-events: none;
            opacity: 0.8;
        }

        /* æ§åˆ¶æŒ‰é’® */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 50px;
            border: none;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            min-width: 100px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(to right, #4d9feb, #2e7dcc);
            color: white;
        }

        .btn-success {
            background: linear-gradient(to right, #4caf50, #2e7d32);
            color: white;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-map-grid {
                grid-template-columns: 1fr;
                max-width: 300px;
            }
            
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .start-button {
                width: 100%;
                max-width: 280px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .game-area {
                padding: 15px;
            }
            
            .question-text {
                font-size: 1.1rem;
                padding: 15px;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>å¿«ä¹è¯»ä¹¦å§ - é˜…è¯»é—¯å…³å¤§å†’é™©</h1>
            <div>äºŒå¹´çº§ä¸Šå†Œ Â· ä¸‰çº§éš¾åº¦æŒ‘æˆ˜ Â· è¾¹è¯»è¾¹ç©</div>
        </div>

        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div class="game-area">
            <!-- é¦–é¡µ -->
            <div id="home-screen">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h2 style="color: #ff6b6b; margin-bottom: 10px;">æ¬¢è¿æ¥åˆ°é˜…è¯»é—¯å…³å¤§å†’é™©ï¼</h2>
                    <p style="color: #666;">äº²çˆ±çš„å°ä¹¦è™«ï¼Œå‡†å¤‡å¥½æŒ‘æˆ˜ä½ çš„é˜…è¯»çŸ¥è¯†äº†å—ï¼Ÿ</p>
                </div>

                <!-- å››å®«æ ¼å¸ƒå±€ -->
                <div class="game-map-grid">
                    <div class="map-level map-level-1">
                        <div class="map-level-icon" id="map-level-1">
                            <i class="fas fa-seedling"></i>
                        </div>
                        <div class="map-level-name">æ–°æ‰‹è®­ç»ƒè¥</div>
                        <div class="map-level-desc">éš¾åº¦â˜…<br>3è½®æŒ‘æˆ˜ï¼Œæ¯è½®15é¢˜</div>
                    </div>
                    
                    <div class="map-level map-level-2">
                        <div class="map-level-icon locked" id="map-level-2">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="map-level-name">é™æ—¶æŒ‘æˆ˜èµ›</div>
                        <div class="map-level-desc">éš¾åº¦â˜…â˜…â˜…<br>10ç§’é™æ—¶ï¼ŒæŒ‘æˆ˜é€Ÿåº¦</div>
                    </div>
                    
                    <div class="map-level map-level-3">
                        <div class="map-level-icon locked" id="map-level-3">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="map-level-name">å·…å³°å¯¹å†³</div>
                        <div class="map-level-desc">éš¾åº¦â˜…â˜…â˜…â˜…â˜…<br>ç”Ÿå­˜æŒ‘æˆ˜ï¼Œç­–ç•¥å¯¹å†³</div>
                    </div>
                    
                    <div class="map-level map-level-4">
                        <div class="map-level-icon locked" id="map-level-4">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="map-level-name">éšæœºå¤§æŒ‘æˆ˜</div>
                        <div class="map-level-desc">éš¾åº¦â˜…â˜…â˜…â˜…<br>60ç§’æŒ‘æˆ˜40é“é¢˜</div>
                    </div>
                </div>

                <div style="margin-top: 30px; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <button class="start-button" id="start-level-1">
                        <i class="fas fa-play"></i> å¼€å§‹æ–°æ‰‹è®­ç»ƒè¥
                    </button>
                    <button class="start-button locked" id="start-level-2" disabled>
                        <i class="fas fa-lock"></i> é™æ—¶æŒ‘æˆ˜èµ› (æœªè§£é”)
                    </button>
                    <button class="start-button locked" id="start-level-3" disabled>
                        <i class="fas fa-lock"></i> å·…å³°å¯¹å†³ (æœªè§£é”)
                    </button>
                    <button class="start-button locked" id="start-level-4" disabled>
                        <i class="fas fa-lock"></i> éšæœºå¤§æŒ‘æˆ˜ (æœªè§£é”)
                    </button>
                </div>
            </div>

            <!-- æ¸¸æˆç•Œé¢ -->
            <div id="game-screen" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="current-level-name">æ–°æ‰‹è®­ç»ƒè¥</h3>
                    <div style="display: flex; gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: #666;">è¿›åº¦</div>
                            <div style="font-weight: bold; font-size: 1.2rem;" id="stage-progress">1/15</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: #666;">å¾—åˆ†</div>
                            <div style="font-weight: bold; font-size: 1.2rem;" id="current-score">0</div>
                        </div>
                    </div>
                </div>

                <!-- é™æ—¶å™¨ -->
                <div class="timer-container" id="timer-container" style="display: none;">
                    <i class="fas fa-clock"></i>
                    <span id="timer">10</span>ç§’
                </div>

                <div class="question-container">
                    <div class="question-text" id="question-text">é¢˜ç›®åŠ è½½ä¸­...</div>
                </div>

                <!-- é€‰é¡¹åŒºåŸŸ -->
                <div class="options-container" id="options-container">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <!-- åˆ¤æ–­é¢˜åŒºåŸŸ -->
                <div id="true-false-container" style="display: none; text-align: center; margin: 20px 0;">
                    <button class="btn btn-success" style="margin-right: 20px;" id="true-btn">âœ“ æ­£ç¡®</button>
                    <button class="btn btn-danger" id="false-btn">âœ— é”™è¯¯</button>
                </div>

                <div class="game-controls">
                    <button class="btn btn-primary" id="submit-btn">
                        <i class="fas fa-paper-plane"></i> æäº¤ç­”æ¡ˆ
                    </button>
                </div>
            </div>

            <!-- ç»“æœç•Œé¢ -->
            <div id="result-screen" style="display: none; text-align: center;">
                <!-- ç»“æœå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // ç®€åŒ–çš„é¢˜åº“
        const questionBank = [
            // ç®€åŒ–ç‰ˆé¢˜åº“ï¼Œåªä¿ç•™å°‘é‡é¢˜ç›®ç¤ºä¾‹
            { id: 1, level: 1, type: "single", question: "å­¤ç‹¬çš„å°èƒèŸ¹çš„ä½œè€…æ˜¯è°ï¼Ÿ", 
              options: ["å†°æ³¢", "å­™å†›", "é™ˆæ³¢å¹"], correctAnswer: 0 },
            
            { id: 2, level: 1, type: "single", question: "å°èƒèŸ¹æ¯å¤©ç¡è§‰å‰æ€»è¦æ•²å‡ ä¸‹å¢™å£ï¼Ÿ", 
              options: ["1ä¸‹", "2ä¸‹", "3ä¸‹"], correctAnswer: 2 },
            
            { id: 3, level: 1, type: "true-false", question: "æœ¨å¤´æ¡©å°–å°–çš„è„‘è¢‹æ€»æ˜¯æ­ªç€çš„ã€‚", 
              options: ["æ­£ç¡®", "é”™è¯¯"], correctAnswer: 0 },
            
            { id: 4, level: 2, type: "single", question: "ã€Šå°é²¤é±¼è·³é¾™é—¨ã€‹ä¸­ï¼Œæ˜¯è°é™¤å»äº†æ‹¦ç€å°é²¤é±¼ä»¬çš„æ°´è‰ï¼Ÿ", 
              options: ["ä¹Œé¾Ÿ", "èƒèŸ¹", "é²¤é±¼å¥¶å¥¶"], correctAnswer: 1 },
            
            { id: 5, level: 3, type: "single", question: "çŒ«æ‘”ç¢äº†çª—å°ä¸Šçš„ä»€ä¹ˆï¼Ÿ", 
              options: ["è“ç“·èŠ±ç›†", "ç»ç’ƒèŠ±ç“¶"], correctAnswer: 0 }
        ];

        // ç®€åŒ–çš„æ¸¸æˆçŠ¶æ€
        const gameState = {
            currentLevel: 1,
            currentQuestionIndex: 0,
            score: 0,
            correctCount: 0,
            currentQuestions: [],
            userAnswers: [],
            timeLeft: 10, // ç¬¬äºŒå…³æ¯é“é¢˜é™æ—¶10ç§’
            timerInterval: null,
            isSecondLevel: false
        };

        // DOMå…ƒç´ å¼•ç”¨
        const homeScreen = document.getElementById('home-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        
        const startButtons = [
            document.getElementById('start-level-1'),
            document.getElementById('start-level-2'),
            document.getElementById('start-level-3'),
            document.getElementById('start-level-4')
        ];
        
        const mapIcons = [
            document.getElementById('map-level-1'),
            document.getElementById('map-level-2'),
            document.getElementById('map-level-3'),
            document.getElementById('map-level-4')
        ];

        const stageProgressElement = document.getElementById('stage-progress');
        const currentScoreElement = document.getElementById('current-score');
        const questionTextElement = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const trueFalseContainer = document.getElementById('true-false-container');
        const trueBtn = document.getElementById('true-btn');
        const falseBtn = document.getElementById('false-btn');
        const submitBtn = document.getElementById('submit-btn');
        const timerContainer = document.getElementById('timer-container');
        const timerElement = document.getElementById('timer');

        // æ¸¸æˆé€»è¾‘å‡½æ•°
        function startLevel(level) {
            gameState.currentLevel = level;
            gameState.currentQuestionIndex = 0;
            gameState.score = 0;
            gameState.correctCount = 0;
            gameState.isSecondLevel = (level === 2);
            
            // æ ¹æ®å…³å¡é€‰æ‹©é¢˜ç›®
            let questionCount = 5; // ç®€åŒ–ä¸º5é¢˜
            if (level === 1) questionCount = 5;
            if (level === 2) {
                questionCount = 5;
                gameState.timeLeft = 10; // ç¬¬äºŒå…³æ¯é¢˜10ç§’
            }
            if (level === 3) questionCount = 5;
            if (level === 4) questionCount = 5;
            
            // é€‰æ‹©é¢˜ç›®
            gameState.currentQuestions = getRandomQuestions(questionCount, level);
            gameState.userAnswers = new Array(questionCount).fill(null);
            
            // æ˜¾ç¤ºæ¸¸æˆç•Œé¢
            homeScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            resultScreen.style.display = 'none';
            
            // è®¾ç½®å…³å¡UI
            const levelNames = ["æ–°æ‰‹è®­ç»ƒè¥", "é™æ—¶æŒ‘æˆ˜èµ›", "å·…å³°å¯¹å†³", "éšæœºå¤§æŒ‘æˆ˜"];
            document.getElementById('current-level-name').textContent = levelNames[level-1];
            
            // æ˜¾ç¤ºæˆ–éšè—è®¡æ—¶å™¨
            if (level === 2) {
                timerContainer.style.display = 'flex';
                startTimer();
            } else {
                timerContainer.style.display = 'none';
            }
            
            // åŠ è½½ç¬¬ä¸€é¢˜
            loadQuestion(0);
        }

        function getRandomQuestions(count, level) {
            // ç­›é€‰å¯¹åº”å…³å¡çš„é¢˜ç›®
            let filteredQuestions = questionBank.filter(q => q.level === level);
            
            // å¦‚æœé¢˜ç›®ä¸è¶³ï¼Œä½¿ç”¨æ‰€æœ‰é¢˜ç›®
            if (filteredQuestions.length < count) {
                filteredQuestions = [...questionBank];
            }
            
            // éšæœºé€‰æ‹©é¢˜ç›®
            let selected = [];
            let available = [...filteredQuestions];
            
            for (let i = 0; i < Math.min(count, available.length); i++) {
                const randomIndex = Math.floor(Math.random() * available.length);
                selected.push(available[randomIndex]);
                available.splice(randomIndex, 1);
            }
            
            return selected;
        }

        function loadQuestion(index) {
            const question = gameState.currentQuestions[index];
            questionTextElement.textContent = question.question;
            
            // æ›´æ–°è¿›åº¦
            stageProgressElement.textContent = `${index + 1}/${gameState.currentQuestions.length}`;
            currentScoreElement.textContent = gameState.score;
            
            // è®¾ç½®é€‰é¡¹
            if (question.type === "single") {
                optionsContainer.style.display = "grid";
                trueFalseContainer.style.display = "none";
                
                optionsContainer.innerHTML = '';
                
                const optionLetters = ['A', 'B', 'C', 'D'];
                question.options.forEach((option, i) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.innerHTML = `
                        <div style="font-weight: bold; margin-right: 10px;">${optionLetters[i]}</div>
                        <div>${option}</div>
                    `;
                    
                    optionElement.addEventListener('click', () => {
                        // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        // è®¾ç½®å½“å‰é€‰æ‹©
                        optionElement.classList.add('selected');
                        gameState.userAnswers[index] = i;
                        
                        // å¯ç”¨æäº¤æŒ‰é’®
                        submitBtn.disabled = false;
                    });
                    
                    // å¦‚æœå·²ç»é€‰æ‹©è¿‡ï¼Œæ¢å¤çŠ¶æ€
                    if (gameState.userAnswers[index] === i) {
                        optionElement.classList.add('selected');
                        submitBtn.disabled = false;
                    }
                    
                    optionsContainer.appendChild(optionElement);
                });
                
            } else if (question.type === "true-false") {
                optionsContainer.style.display = "none";
                trueFalseContainer.style.display = "block";
                
                // é‡ç½®æŒ‰é’®çŠ¶æ€
                trueBtn.classList.remove('selected');
                falseBtn.classList.remove('selected');
                
                // è®¾ç½®ç‚¹å‡»äº‹ä»¶
                trueBtn.onclick = () => {
                    trueBtn.classList.add('selected');
                    falseBtn.classList.remove('selected');
                    gameState.userAnswers[index] = 0;
                    submitBtn.disabled = false;
                };
                
                falseBtn.onclick = () => {
                    falseBtn.classList.add('selected');
                    trueBtn.classList.remove('selected');
                    gameState.userAnswers[index] = 1;
                    submitBtn.disabled = false;
                };
                
                // æ¢å¤ä¹‹å‰çš„é€‰æ‹©
                if (gameState.userAnswers[index] === 0) {
                    trueBtn.classList.add('selected');
                    submitBtn.disabled = false;
                } else if (gameState.userAnswers[index] === 1) {
                    falseBtn.classList.add('selected');
                    submitBtn.disabled = false;
                }
            }
            
            // é‡ç½®æäº¤æŒ‰é’®çŠ¶æ€
            if (gameState.userAnswers[index] === null) {
                submitBtn.disabled = true;
            }
        }

        function startTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timeLeft = 10; // ç¬¬äºŒå…³æ¯é¢˜10ç§’
            updateTimerDisplay();
            
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                updateTimerDisplay();
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timerInterval);
                    handleTimeout();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            timerElement.textContent = gameState.timeLeft;
            
            timerContainer.classList.remove('warning', 'danger');
            if (gameState.timeLeft <= 5) {
                timerContainer.classList.add('warning');
            }
            if (gameState.timeLeft <= 3) {
                timerContainer.classList.add('danger');
            }
        }

        function handleTimeout() {
            // è¶…æ—¶è‡ªåŠ¨æäº¤é”™è¯¯ç­”æ¡ˆ
            const currentIndex = gameState.currentQuestionIndex;
            gameState.userAnswers[currentIndex] = -1; // æ ‡è®°ä¸ºè¶…æ—¶
            
            // æ˜¾ç¤ºç­”æ¡ˆåé¦ˆ
            showAnswerFeedback(currentIndex);
            
            // å»¶è¿Ÿåè‡ªåŠ¨ä¸‹ä¸€é¢˜
            setTimeout(() => {
                autoNextQuestion();
            }, 1500);
        }

        function submitAnswer() {
            const currentIndex = gameState.currentQuestionIndex;
            const question = gameState.currentQuestions[currentIndex];
            const userAnswer = gameState.userAnswers[currentIndex];
            
            if (userAnswer === null || userAnswer === -1) return;
            
            // åœæ­¢è®¡æ—¶å™¨ï¼ˆå¦‚æœæ˜¯ç¬¬äºŒå…³ï¼‰
            if (gameState.isSecondLevel) {
                clearInterval(gameState.timerInterval);
            }
            
            // æ£€æŸ¥ç­”æ¡ˆ
            const isCorrect = (userAnswer === question.correctAnswer);
            
            if (isCorrect) {
                gameState.score += 20;
                gameState.correctCount++;
            }
            
            // æ˜¾ç¤ºç­”æ¡ˆåé¦ˆ
            showAnswerFeedback(currentIndex);
            
            // å»¶è¿Ÿåè‡ªåŠ¨ä¸‹ä¸€é¢˜
            setTimeout(() => {
                autoNextQuestion();
            }, 1500);
        }

        function showAnswerFeedback(index) {
            const question = gameState.currentQuestions[index];
            const userAnswer = gameState.userAnswers[index];
            
            if (question.type === "single") {
                const options = document.querySelectorAll('.option');
                
                // æ ‡è®°æ­£ç¡®ç­”æ¡ˆ
                options[question.correctAnswer].classList.add('correct');
                
                // æ ‡è®°é”™è¯¯ç­”æ¡ˆï¼ˆå¦‚æœç”¨æˆ·ç­”é”™ï¼‰
                if (userAnswer !== question.correctAnswer && userAnswer >= 0) {
                    options[userAnswer].classList.add('incorrect');
                }
                
                // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
                options.forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });
                
            } else if (question.type === "true-false") {
                if (question.correctAnswer === 0) {
                    trueBtn.classList.add('correct');
                    if (userAnswer === 1) {
                        falseBtn.classList.add('incorrect');
                    }
                } else {
                    falseBtn.classList.add('correct');
                    if (userAnswer === 0) {
                        trueBtn.classList.add('incorrect');
                    }
                }
                
                trueBtn.style.pointerEvents = 'none';
                falseBtn.style.pointerEvents = 'none';
            }
            
            submitBtn.disabled = true;
        }

        function autoNextQuestion() {
            // è‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€é¢˜æˆ–å®Œæˆæ¸¸æˆ
            if (gameState.currentQuestionIndex < gameState.currentQuestions.length - 1) {
                gameState.currentQuestionIndex++;
                loadQuestion(gameState.currentQuestionIndex);
                
                // å¦‚æœæ˜¯ç¬¬äºŒå…³ï¼Œé‡å¯è®¡æ—¶å™¨
                if (gameState.isSecondLevel) {
                    startTimer();
                }
            } else {
                finishGame();
            }
        }

        function finishGame() {
            clearInterval(gameState.timerInterval);
            
            const totalQuestions = gameState.currentQuestions.length;
            const accuracy = Math.round((gameState.correctCount / totalQuestions) * 100);
            const passed = accuracy >= 70;
            
            gameScreen.style.display = 'none';
            resultScreen.style.display = 'block';
            
            let resultHTML = `
                <div style="margin: 30px 0;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">${passed ? 'ğŸ‰' : 'ğŸ’ª'}</div>
                    <h2 style="color: ${passed ? '#4caf50' : '#ff6b6b'}; margin-bottom: 15px;">
                        ${passed ? 'æ­å–œé€šå…³ï¼' : 'ç»§ç»­åŠªåŠ›ï¼'}
                    </h2>
                    <div style="font-size: 2.5rem; color: #ffcc00; font-weight: bold; margin-bottom: 20px;">
                        ${gameState.score}åˆ†
                    </div>
                </div>
                
                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ç­”é¢˜æ•°é‡</span>
                        <span style="font-weight: bold;">${totalQuestions}é¢˜</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ç­”å¯¹é¢˜æ•°</span>
                        <span style="font-weight: bold;">${gameState.correctCount}é¢˜</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>æ­£ç¡®ç‡</span>
                        <span style="font-weight: bold;">${accuracy}%</span>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="back-to-home-btn" style="margin-top: 20px;">
                    <i class="fas fa-home"></i> è¿”å›é¦–é¡µ
                </button>
            `;
            
            resultScreen.innerHTML = resultHTML;
            
            // è§£é”ä¸‹ä¸€å…³ï¼ˆå¦‚æœé€šè¿‡ï¼‰
            if (passed && gameState.currentLevel < 4) {
                const nextLevel = gameState.currentLevel;
                startButtons[nextLevel].classList.remove('locked');
                startButtons[nextLevel].disabled = false;
                startButtons[nextLevel].innerHTML = `<i class="fas fa-play"></i> å¼€å§‹${['', 'é™æ—¶æŒ‘æˆ˜èµ›', 'å·…å³°å¯¹å†³', 'éšæœºå¤§æŒ‘æˆ˜'][nextLevel]}`;
                
                mapIcons[nextLevel].classList.remove('locked');
            }
            
            // ç»‘å®šè¿”å›æŒ‰é’®äº‹ä»¶
            document.getElementById('back-to-home-btn').addEventListener('click', () => {
                resultScreen.style.display = 'none';
                homeScreen.style.display = 'block';
            });
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        startButtons.forEach((btn, index) => {
            if (!btn.classList.contains('locked')) {
                btn.addEventListener('click', () => startLevel(index + 1));
            }
        });

        submitBtn.addEventListener('click', submitAnswer);

        // åˆå§‹çŠ¶æ€ï¼šåªè§£é”ç¬¬ä¸€å…³
        startButtons[0].addEventListener('click', () => startLevel(1));
    </script>
</body>
</html>
